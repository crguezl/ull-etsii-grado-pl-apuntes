<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Ejemplo de Transformaciones Árbol: Parse::Eyapp::TreeRegexp</TITLE>
<META NAME="description" CONTENT="Ejemplo de Transformaciones Árbol: Parse::Eyapp::TreeRegexp">
<META NAME="keywords" CONTENT="javascriptexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node74.html">
<LINK REL="previous" HREF="node72.html">
<LINK REL="up" HREF="node69.html">
<LINK REL="next" HREF="node74.html">
</HEAD>

<BODY >

<DIV CLASS="navigation">
<A NAME="tex2html2180"
  HREF="node74.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html2174"
  HREF="node69.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html2168"
  HREF="node72.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html2176"
  HREF="node88.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html2178"
  HREF="node91.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/perlexamples/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="Apuntes de LPP"></A><A NAME="tex2html3"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5669"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2014/2015"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2013/2014"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="https://plus.google.com/u/0/communities/103299470687051533933"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1415"></A><A NAME="tex2html7"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html8"
  HREF="http://www.ull.es/view/centros/etsii/Grado_en_Ingenieria_Informatica/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html9"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html10"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html2181"
  HREF="node74.html">Treehugger</A>
<B>Sup:</B> <A NAME="tex2html2175"
  HREF="node69.html">Transformaciones Árbol</A>
<B> Ant:</B> <A NAME="tex2html2169"
  HREF="node72.html">Patrones Árbol y Transformaciones</A>
<B> Con:</B> 
<A NAME="tex2html2176"
  HREF="node88.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>
<B> Ind:</B> 
<A NAME="tex2html2178"
  HREF="node91.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A>
<BR> <P>
</DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html2182"
  HREF="node73.html#SECTION04740010000000000000">Instalación</A>
<LI><A NAME="tex2html2183"
  HREF="node73.html#SECTION04740020000000000000">Donde</A>
<LI><A NAME="tex2html2184"
  HREF="node73.html#SECTION04740030000000000000">La gramática: Expresiones</A>
<LI><A NAME="tex2html2185"
  HREF="node73.html#SECTION04740040000000000000">Ejecución</A>
<LI><A NAME="tex2html2186"
  HREF="node73.html#SECTION04740050000000000000">synopsis.pl</A>
<LI><A NAME="tex2html2187"
  HREF="node73.html#SECTION04740060000000000000">El método <TT>s</TT></A>
<LI><A NAME="tex2html2188"
  HREF="node73.html#SECTION04740070000000000000">Véase</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION04740000000000000000">
Ejemplo de Transformaciones Árbol: Parse::Eyapp::TreeRegexp</A>
</H1>

<P>

<H4><A NAME="SECTION04740010000000000000">
Instalación</A>
</H4>
  

<P>
<PRE>
[~/jison/jison-aSb(master)]$ sudo cpan Parse::Eyapp
</PRE>

<P>

<H4><A NAME="SECTION04740020000000000000">
Donde</A>
</H4>
  

<P>

<UL>
<LI><PRE>
[~/src/perl/parse-eyapp/examples/MatchingTrees]$ pwd -P
/Users/casiano/local/src/perl/parse-eyapp/examples/MatchingTrees
</PRE>
</LI>
<LI><A NAME="tex2html313"
  HREF="http://search.cpan.org/~casiano/Parse-Eyapp-1.182/lib/Parse/Eyapp/eyapp">Parse::Eyapp</A>
</LI>
<LI><A NAME="tex2html314"
  HREF="https://github.com/gitpan/Parse-Eyapp/blob/master/examples/MatchingTrees/synopsis.pl">Ejemplo de uso de Parse::Eyapp::Treeregexp</A>
</LI>
<LI><A NAME="tex2html315"
  HREF="https://github.com/gitpan/Parse-Eyapp/blob/master/lib/Parse/Eyapp/MatchingTrees.pod">Tree Matching and Tree Substitution</A>
</LI>
<LI><A NAME="tex2html316"
  HREF="https://github.com/gitpan/Parse-Eyapp/blob/master/lib/Parse/Eyapp/Node.pm#L149-L172">Node.pm</A>
(Véase el método <code>s</code>)
</LI>
</UL>

<P>

<H4><A NAME="SECTION04740030000000000000">
La gramática: Expresiones</A>
</H4>
  

<P>
<PRE>
my $grammar = q{
  %lexer {
      m{\G\s+}gc;
      m{\G([0-9]+(?:\.[0-9]+)?)}gc and return('NUM',$1);
      m{\G([A-Za-z][A-Za-z0-9_]*)}gc and return('VAR',$1);
      m{\G(.)}gcs and return($1,$1);
  }

  %right  '='     # Lowest precedence
  %left   '-' '+' # + and - have more precedence than = Disambiguate a-b-c as (a-b)-c
  %left   '*' '/' # * and / have more precedence than + Disambiguate a/b/c as (a/b)/c
  %left   NEG     # Disambiguate -a-b as (-a)-b and not as -(a-b)
  %tree           # Let us build an abstract syntax tree ...

  %%
  line: 
      exp &lt;%name EXPRESSION_LIST + ';'&gt;  
        { $_[1] } /* list of expressions separated by ';' */
  ;

  /* The %name directive defines the name of the
     class to which the node being built belongs */
  exp:
      %name NUM  
      NUM            
    | %name VAR   
      VAR         
    | %name ASSIGN 
      VAR '=' exp 
    | %name PLUS 
      exp '+' exp    
    | %name MINUS 
      exp '-' exp 
    | %name TIMES  
      exp '*' exp 
    | %name DIV     
      exp '/' exp 
    | %name UMINUS 
      '-' exp %prec NEG 
    | '(' exp ')'  
        { $_[2] }  /* Let us simplify a bit the tree */
  ;

  %%
}; # end grammar
</PRE>

<P>

<H4><A NAME="SECTION04740040000000000000">
Ejecución</A>
</H4>
  

<PRE>
El trozo de código:
\begin{verbatim}
$parser-&gt;input(\"2*-3+b*0;--2\n");       # Set the input
my $t = $parser-&gt;YYParse;
</PRE>
da lugar a este árbol:
<PRE>
[~/src/perl/parse-eyapp/examples/MatchingTrees]$ ./synopsis.pl 
Syntax Tree:
EXPRESSION_LIST(
  PLUS(
    TIMES(
      NUM( TERMINAL[2]),
      UMINUS( NUM( TERMINAL[3])) # UMINUS
    ) # TIMES,
    TIMES( VAR( TERMINAL[b]), NUM( TERMINAL[0])) # TIMES
  ) # PLUS,
  UMINUS(
    UMINUS( NUM( TERMINAL[2])) # UMINUS
  ) # UMINUS
) # EXPRESSION_LIST
</PRE>
Al aplicar las transformaciones:
<PRE>
# Let us transform the tree. Define the tree-regular expressions ..
my $p = Parse::Eyapp::Treeregexp-&gt;new( STRING =&gt; q{
    { #  Example of support code
      my %Op = (PLUS=&gt;'+', MINUS =&gt; '-', TIMES=&gt;'*', DIV =&gt; '/');
    }
    constantfold: /TIMES|PLUS|DIV|MINUS/:bin(NUM($x), NUM($y)) 
      =&gt; { 
        my $op = $Op{ref($bin)};
        $x-&gt;{attr} = eval  "$x-&gt;{attr} $op $y-&gt;{attr}";
        $_[0] = $NUM[0]; 
      }
    uminus: UMINUS(NUM($x)) =&gt; { $x-&gt;{attr} = -$x-&gt;{attr}; $_[0] = $NUM }
    zero_times_whatever: TIMES(NUM($x), .) and { $x-&gt;{attr} == 0 } =&gt; { $_[0] = $NUM }
    whatever_times_zero: TIMES(., NUM($x)) and { $x-&gt;{attr} == 0 } =&gt; { $_[0] = $NUM }
  },
  OUTPUTFILE=&gt; 'main.pm'
);
$p-&gt;generate(); # Create the tranformations

$t-&gt;s($uminus); # Transform UMINUS nodes
$t-&gt;s(@all);    # constant folding and mult. by zero
</PRE>
Obtenemos el árbol:
<PRE>
Syntax Tree after transformations:
EXPRESSION_LIST(NUM(TERMINAL[-6]),NUM(TERMINAL[2]))
</PRE>

<P>

<H4><A NAME="SECTION04740050000000000000">
synopsis.pl</A>
</H4>
  

<P>
<PRE>
[~/src/perl/parse-eyapp/examples/MatchingTrees]$ cat synopsis.pl 
#!/usr/bin/perl -w
use strict;
use Parse::Eyapp;
use Parse::Eyapp::Treeregexp;

sub TERMINAL::info {
  $_[0]{attr}
}

my $grammar = q{
  %lexer {
      m{\G\s+}gc;
      m{\G([0-9]+(?:\.[0-9]+)?)}gc and return('NUM',$1);
      m{\G([A-Za-z][A-Za-z0-9_]*)}gc and return('VAR',$1);
      m{\G(.)}gcs and return($1,$1);
  }

  %right  '='     # Lowest precedence
  %left   '-' '+' # + and - have more precedence than = Disambiguate a-b-c as (a-b)-c
  %left   '*' '/' # * and / have more precedence than + Disambiguate a/b/c as (a/b)/c
  %left   NEG     # Disambiguate -a-b as (-a)-b and not as -(a-b)
  %tree           # Let us build an abstract syntax tree ...

  %%
  line: 
      exp &lt;%name EXPRESSION_LIST + ';'&gt;  
        { $_[1] } /* list of expressions separated by ';' */
  ;

  /* The %name directive defines the name of the
     class to which the node being built belongs */
  exp:
      %name NUM  
      NUM            
    | %name VAR   
      VAR         
    | %name ASSIGN 
      VAR '=' exp 
    | %name PLUS 
      exp '+' exp    
    | %name MINUS 
      exp '-' exp 
    | %name TIMES  
      exp '*' exp 
    | %name DIV     
      exp '/' exp 
    | %name UMINUS 
      '-' exp %prec NEG 
    | '(' exp ')'  
        { $_[2] }  /* Let us simplify a bit the tree */
  ;

  %%
}; # end grammar

our (@all, $uminus);

Parse::Eyapp-&gt;new_grammar( # Create the parser package/class
  input=&gt;$grammar,    
  classname=&gt;'Calc', # The name of the package containing the parser
); 
my $parser = Calc-&gt;new();                # Create a parser
$parser-&gt;input(\"2*-3+b*0;--2\n");       # Set the input
my $t = $parser-&gt;YYParse;                # Parse it!
local $Parse::Eyapp::Node::INDENT=2;
print "Syntax Tree:",$t-&gt;str;

# Let us transform the tree. Define the tree-regular expressions ..
my $p = Parse::Eyapp::Treeregexp-&gt;new( STRING =&gt; q{
    { #  Example of support code
      my %Op = (PLUS=&gt;'+', MINUS =&gt; '-', TIMES=&gt;'*', DIV =&gt; '/');
    }
    constantfold: /TIMES|PLUS|DIV|MINUS/:bin(NUM($x), NUM($y)) 
      =&gt; { 
        my $op = $Op{ref($bin)};
        $x-&gt;{attr} = eval  "$x-&gt;{attr} $op $y-&gt;{attr}";
        $_[0] = $NUM[0]; 
      }
    uminus: UMINUS(NUM($x)) =&gt; { $x-&gt;{attr} = -$x-&gt;{attr}; $_[0] = $NUM }
    zero_times_whatever: TIMES(NUM($x), .) and { $x-&gt;{attr} == 0 } =&gt; { $_[0] = $NUM }
    whatever_times_zero: TIMES(., NUM($x)) and { $x-&gt;{attr} == 0 } =&gt; { $_[0] = $NUM }
  },
  OUTPUTFILE=&gt; 'main.pm'
);
$p-&gt;generate(); # Create the tranformations

$t-&gt;s($uminus); # Transform UMINUS nodes
$t-&gt;s(@all);    # constant folding and mult. by zero

local $Parse::Eyapp::Node::INDENT=0;
print "\nSyntax Tree after transformations:\n",$t-&gt;str,"\n";
</PRE>

<P>

<H4><A NAME="SECTION04740060000000000000">
El método <TT>s</TT></A>
</H4>
  

<P>
El código de <code>s</code> está en 
<A NAME="tex2html317"
  HREF="https://github.com/gitpan/Parse-Eyapp/blob/master/lib/Parse/Eyapp/Node.pm">lib/Parse/Eyapp/Node.pm</A>:
<PRE>
sub s {
  my @patterns = @_[1..$#_];

  # Make them Parse::Eyapp:YATW objects if they are CODE references
  @patterns = map { ref($_) eq 'CODE'? 
                      Parse::Eyapp::YATW-&gt;new(
                        PATTERN =&gt; $_,
                        #PATTERN_ARGS =&gt; [],
                      )
                      :
                      $_
                  } 
                  @patterns;
  my $changes; 
  do { 
    $changes = 0;
    foreach (@patterns) {
      $_-&gt;{CHANGES} = 0;
      $_-&gt;s($_[0]);
      $changes += $_-&gt;{CHANGES};
    }
  } while ($changes);
}
</PRE>

<P>

<H4><A NAME="SECTION04740070000000000000">
Véase</A>
</H4>
  

<UL>
<LI><A NAME="tex2html318"
  HREF="http://search.cpan.org/~casiano/Parse-Eyapp-1.182/lib/Parse/Eyapp/eyapp">Parse::Eyapp</A>
</LI>
<LI><A NAME="tex2html319"
  HREF="https://github.com/gitpan/Parse-Eyapp/blob/master/examples/MatchingTrees/synopsis.pl">Ejemplo de uso de Parse::Eyapp::Treeregexp</A>
</LI>
<LI><A NAME="tex2html320"
  HREF="https://github.com/gitpan/Parse-Eyapp/blob/master/lib/Parse/Eyapp/MatchingTrees.pod">Tree Matching and Tree Substitution</A>
</LI>
<LI><A NAME="tex2html321"
  HREF="https://github.com/gitpan/Parse-Eyapp/blob/master/lib/Parse/Eyapp/Node.pm#L149-L172">Node.pm</A>
(Véase el método <code>s</code>)
</LI>
</UL>

<P>

<DIV CLASS="navigation"><HR>
<A NAME="tex2html2180"
  HREF="node74.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html2174"
  HREF="node69.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html2168"
  HREF="node72.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html2176"
  HREF="node88.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html2178"
  HREF="node91.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/perlexamples/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="Apuntes de LPP"></A><A NAME="tex2html3"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5669"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2014/2015"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle 2013/2014"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="https://plus.google.com/u/0/communities/103299470687051533933"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1415"></A><A NAME="tex2html7"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html8"
  HREF="http://www.ull.es/view/centros/etsii/Grado_en_Ingenieria_Informatica/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html9"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html10"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html2181"
  HREF="node74.html">Treehugger</A>
<B>Sup:</B> <A NAME="tex2html2175"
  HREF="node69.html">Transformaciones Árbol</A>
<B> Ant:</B> <A NAME="tex2html2169"
  HREF="node72.html">Patrones Árbol y Transformaciones</A>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2015-02-05</I>
</ADDRESS>
</BODY>
</HTML>
