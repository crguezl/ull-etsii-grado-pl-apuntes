<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Introducción</TITLE>
<META NAME="description" CONTENT="Introducción">
<META NAME="keywords" CONTENT="javascriptexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node97.html">
<LINK REL="previous" HREF="node95.html">
<LINK REL="up" HREF="node95.html">
<LINK REL="next" HREF="node97.html">
</HEAD>

<BODY >

<DIV CLASS="navigation">
<A NAME="tex2html3585"
  HREF="node97.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html3579"
  HREF="node95.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html3573"
  HREF="node95.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html3581"
  HREF="node120.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html3583"
  HREF="node123.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~plgrado/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1213m2/course/view.php?id=271"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="http://crguezl.github.io/pl-html/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html7"
  HREF="https://developer.mozilla.org/es/docs/JavaScript"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html8"
  HREF="http://github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html9"
  HREF="https://plus.google.com/u/0/communities/107031495100582318205"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1314"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.ull.es/view/centros/etsii/Grado/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html3586"
  HREF="node97.html">Logging</A>
<B>Sup:</B> <A NAME="tex2html3580"
  HREF="node95.html">Heroku</A>
<B> Ant:</B> <A NAME="tex2html3574"
  HREF="node95.html">Heroku</A>
<B> Con:</B> 
<A NAME="tex2html3581"
  HREF="node120.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>
<B> Ind:</B> 
<A NAME="tex2html3583"
  HREF="node123.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A>
<BR> <P>
</DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html3587"
  HREF="node96.html#SECTION06110010000000000000">Prerequisitos</A>
<LI><A NAME="tex2html3588"
  HREF="node96.html#SECTION06110020000000000000">Instala el Heroku Toolbelt</A>
<LI><A NAME="tex2html3589"
  HREF="node96.html#SECTION06110030000000000000">Actualizaciones</A>
<LI><A NAME="tex2html3590"
  HREF="node96.html#SECTION06110040000000000000">Ayuda</A>
<LI><A NAME="tex2html3591"
  HREF="node96.html#SECTION06110050000000000000">Specify Ruby Version and Declare dependencies with a Gemfile</A>
<LI><A NAME="tex2html3592"
  HREF="node96.html#SECTION06110060000000000000">Declare process types with <TT>Procfile</TT></A>
<LI><A NAME="tex2html3593"
  HREF="node96.html#SECTION06110070000000000000">Foreman</A>
<LI><A NAME="tex2html3594"
  HREF="node96.html#SECTION06110080000000000000">Setting local environment variables</A>
<LI><A NAME="tex2html3595"
  HREF="node96.html#SECTION06110090000000000000">Procfile y Despliegue</A>
<LI><A NAME="tex2html3596"
  HREF="node96.html#SECTION061100100000000000000">Store your app in Git</A>
<LI><A NAME="tex2html3597"
  HREF="node96.html#SECTION061100110000000000000">Deploy your application to Heroku</A>
<LI><A NAME="tex2html3598"
  HREF="node96.html#SECTION061100120000000000000">Visit your application</A>
<LI><A NAME="tex2html3599"
  HREF="node96.html#SECTION061100130000000000000">Dyno sleeping and scaling</A>
<LI><A NAME="tex2html3600"
  HREF="node96.html#SECTION061100140000000000000">View the logs</A>
<LI><A NAME="tex2html3601"
  HREF="node96.html#SECTION061100150000000000000"><FONT COLOR="#ff0000"> heroku run bash</FONT></A>
<LI><A NAME="tex2html3602"
  HREF="node96.html#SECTION061100160000000000000"><FONT COLOR="#ff0000"> heroku run console</FONT></A>
<LI><A NAME="tex2html3603"
  HREF="node96.html#SECTION061100170000000000000">Rake</A>
<LI><A NAME="tex2html3604"
  HREF="node96.html#SECTION061100180000000000000">Using a SQL database</A>
<LI><A NAME="tex2html3605"
  HREF="node96.html#SECTION061100190000000000000">Webserver</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION06110000000000000000">
Introducción</A>
</H1>

<P>

<H4><A NAME="SECTION06110010000000000000">
Prerequisitos</A>
</H4>
  

Estos son los prerequisitos (Octubre 2013)

<OL>
<LI>Basic Ruby knowledge, including an installed version of Ruby 2.0.0, Rubygems, and Bundler.
</LI>
<LI>Basic Git knowledge
</LI>
<LI>Your application must run on Ruby (MRI) 2.0.0.
</LI>
<LI>Your application must use Bundler.
</LI>
<LI>A Heroku user account. 
</LI>
</OL>

<P>

<H4><A NAME="SECTION06110020000000000000">
Instala el Heroku Toolbelt</A>
</H4>
  

<P>

<OL>
<LI><A NAME="tex2html501"
  HREF="https://id.heroku.com/signup/www-header">Crea una cuenta en Heroku</A>
</LI>
<LI>El
<A NAME="tex2html502"
  HREF="https://toolbelt.heroku.com/">Heroku Toolbelt</A>
se compone de:
  
<OL>
<LI>Heroku client - CLI tool for creating and managing Heroku apps
</LI>
<LI>Foreman - an easy option for running your apps locally
</LI>
<LI>Git - revision control and pushing to Heroku
  
</LI>
</OL>
</LI>
</OL>

<P>
La primera vez te pedirá las credenciales:
<PRE>
$ heroku login
Enter your Heroku credentials.
Email: adam@example.com
Password: 
Could not find an existing public key.
Would you like to generate one? [Yn] 
Generating new SSH public key.
Uploading ssh public key /Users/adam/.ssh/id_rsa.pub
</PRE>
La clave la cargas en la sección <code>SSH keys add key</code> de
<A NAME="tex2html503"
  HREF="https://dashboard.heroku.com/account">https://dashboard.heroku.com/account</A>
<P>
<PRE>
[~/rack/rack-rock-paper-scissors(test)]$ heroku --version
heroku-gem/2.39.4 (x86_64-darwin11.4.2) ruby/1.9.3
</PRE>

<P>
<PRE>
[~/local/src/ruby/sinatra/rack/rack-rock-paper-scissors(test)]$  which heroku
/Users/casiano/.rvm/gems/ruby-1.9.3-p392/bin/heroku
[~/local/src/ruby/sinatra/rack/rack-rock-paper-scissors(test)]$ ruby -v
ruby 1.9.3p392 (2013-02-22 revision 39386) [x86_64-darwin11.4.2]
</PRE>
Seguramente tienes que instalar una versión del toolbet por cada versión de Ruby con la que quieras usarlo.

<P>
Para desinstalarlo:
<PRE>
$ gem uninstall heroku --all
</PRE>

<P>

<H4><A NAME="SECTION06110030000000000000">
Actualizaciones</A>
</H4>
  

The Heroku Toolbelt will automatically keep itself up to date.

<P>

<OL>
<LI>When you run a heroku command, a background process will be spawned
that checks a URL for the latest available version of the CLI. 
</LI>
<LI>If
a new version is found, it will be downloaded and stored in
<code>~/.heroku/client</code>. 
</LI>
<LI>This background check will happen at most once
every 5 minutes.
</LI>
<LI>The heroku binary will check for updated clients in <code>~/.heroku/client</code>
before loading the system-installed version.
</LI>
</OL>

<P>

<H4><A NAME="SECTION06110040000000000000">
Ayuda</A>
</H4>
  

<P>
<PRE>
[~/local/src/ruby/sinatra/rack/rack-rock-paper-scissors(master)]$ heroku --help
Usage: heroku COMMAND [--app APP] [command-specific-options]

Primary help topics, type "heroku help TOPIC" for more details:

  addons    #  manage addon resources
  apps      #  manage apps (create, destroy)
  auth      #  authentication (login, logout)
  config    #  manage app config vars
  domains   #  manage custom domains
  logs      #  display logs for an app
  ps        #  manage dynos (dynos, workers)
  releases  #  manage app releases
  run       #  run one-off commands (console, rake)
  sharing   #  manage collaborators on an app

Additional topics:

  account      #  manage heroku account options
  certs        #  manage ssl endpoints for an app
  db           #  manage the database for an app
  drains       #  display syslog drains for an app
  fork         #  clone an existing app
  git          #  manage git for apps
  help         #  list commands and display help
  keys         #  manage authentication keys
  labs         #  manage optional features
  maintenance  #  manage maintenance mode for an app
  pg           #  manage heroku-postgresql databases
  pgbackups    #  manage backups of heroku postgresql databases
  plugins      #  manage plugins to the heroku gem
  regions      #  list available regions
  stack        #  manage the stack for an app
  status       #  check status of heroku platform
  update       #  update the heroku client
  version      #  display version
</PRE>

<P>

<H4><A NAME="SECTION06110050000000000000">
Specify Ruby Version and Declare dependencies with a Gemfile</A>
</H4>
  

<P>
Heroku recognizes an app as Ruby by the existence of a <code>Gemfile</code>.

<P>
Even if your app has no gem dependencies, you should still create
an empty <code>Gemfile</code> in order that it appear as a Ruby app.

<P>
In local testing, you should be sure to run your app in an isolated
environment (via <code>bundle exec</code> or an empty RVM gemset), to make sure
that all the gems your app depends on are in the <code>Gemfile</code>.

<P>
In addition to specifying dependencies, you’ll want to specify your
Ruby Version using the ruby DSL provided by Bundler.

<P>
Here’s an example <code>Gemfile</code> for a Sinatra app:

<P>
<PRE>
source "https://rubygems.org"
ruby "2.0.0"
gem 'sinatra', '1.1.0'
</PRE>

<P>
<PRE>
[~/sinatra/rockpaperscissors(master)]$ cat Gemfile
source 'https://rubygems.org'
gem 'sinatra'
gem 'haml'
gem 'puma'
</PRE>

<P>
Run <code>bundle install</code> to set up your bundle locally.

<OL>
<LI>Run:
<PRE>
$ bundle install
</PRE>
</LI>
<LI>This ensures that all gems specified in Gemfile, together with their
dependencies, are available for your application.
</LI>
<LI>Running bundle
install also generates a <code>Gemfile.lock</code> file, <SPAN  CLASS="textbf">which should be added
to your git repository</SPAN>. 
</LI>
<LI><code>Gemfile.lock</code> ensures that your deployed
versions of gems on Heroku match the version installed locally on
your development machine.
</LI>
</OL>

<P>

<H4><A NAME="SECTION06110060000000000000">
Declare process types with <TT>Procfile</TT></A>
</H4>
  

<A NAME="parrafo:procfile"></A>
<P>
Process types are declared via a file named  <TT>Procfile</TT>  placed in the
root of your app. 

<P>
Its format is one process type per line, with
each line containing:
<PRE>
&lt;process type&gt;: &lt;command&gt;
</PRE>
The syntax is defined as:

<P>

<OL>
<LI><code>&lt;process type&gt;</code> – an alphanumeric string, is a name for your command, such as 
  
<OL>
<LI><code>web</code>, 
</LI>
<LI><code>worker</code>, 
</LI>
<LI><code>urgentworker</code>, 
</LI>
<LI><code>clock</code>, etc.
  
</LI>
</OL>
</LI>
<LI><code>&lt;command&gt;</code> – a command line to launch the process, such as <code>rake jobs:work</code>.
</LI>
</OL>
The  <TT>web</TT>  process type 
<FONT COLOR="#ff0000"> is special as it’s the only process type that
will receive HTTP traffic from Heroku’s routers</FONT>.

<P>

<OL>
<LI>Use a  <TT>Procfile</TT> , a text file in the root directory of your
application, to explicitly declare what command should be executed
to start a <A NAME="16332"></A><SPAN  CLASS="textbf">web dyno</SPAN>. 

<P>
</LI>
<LI>Assume for instance, that we wanto to execute 
<code>web.rb</code> using Ruby.
Here’s a <code>Procfile</code>:
<PRE>
web: bundle exec ruby web.rb -p $PORT
</PRE>
</LI>
<LI>If we are instead deploying a straight Rack app, here’s a Procfile
that can execute our config.ru:
<PRE>
web: bundle exec rackup config.ru -p $PORT
</PRE>

<P>
<PRE>
[~/sinatra/rockpaperscissors(spec)]$ cat config.ru 
#\ -s puma
require './rps'
run RockPaperScissors::App
</PRE>
</LI>
</OL>

<P>

<OL>
<LI>This declares a single process type, <code>web</code>, and the command needed
to run it. 
</LI>
<LI>The name <code>web</code> is important here. 
It declares that this
process type will be attached to the HTTP routing stack of Heroku,
and receive web traffic when deployed.
</LI>
</OL>

<P>

<H4><A NAME="SECTION06110070000000000000">
Foreman</A>
</H4>
  

<OL>
<LI>It’s important when developing and debugging an application that
the local development environment is executed in the same manner
as the remote environments. 

<P>
</LI>
<LI>This ensures that incompatibilities and
hard to find bugs are caught before deploying to production and
treats the application as a holistic unit instead of a series of
individual commands working independently.

<P>
</LI>
<LI>Foreman is a command-line tool for running Procfile-backed apps.
It’s installed automatically by the Heroku Toolbelt.

<P>
</LI>
<LI>If you had a Procfile with both web and worker process types, Foreman
will start one of each process type, with the output interleaved
on your terminal

<P>
</LI>
<LI>We can now start our application locally using Foreman (installed as part of the Toolbelt):
<PRE>
$ foreman start
16:39:04 web.1     | started with pid 30728
18:49:43 web.1     | [2013-03-12 18:49:43] INFO  WEBrick 1.3.1
18:49:43 web.1     | [2013-03-12 18:49:43] INFO  ruby 2.0.0p247 (2013-06-27 revision 41674) [x86_64-linux]
18:49:43 web.1     | [2013-03-12 18:49:43] INFO  WEBrick::HTTPServer#start: pid=30728 port=5000
</PRE>
</LI>
<LI>Our app will come up on port 5000. Test that it’s working with 
<code>curl</code>
or a web browser, then <code>Ctrl-C</code> to exit.
</LI>
</OL>

<P>

<H4><A NAME="SECTION06110080000000000000">
Setting local environment variables</A>
</H4>
  

<P>
Config vars saved in the <code>.env</code> file of a project directory will be
added to the environment when run by Foreman. 

<P>
For example we can
set the <code>RACK_ENV</code> to <code>development</code> in your environment.
<PRE>
$ echo "RACK_ENV=development" &gt;&gt;.env
$ foreman run irb
&gt; puts ENV["RACK_ENV"]
&gt; development
</PRE>
Do not commit the <code>.env</code> file to source control.
It should only be used for local configuration.

<P>

<H4><A NAME="SECTION06110090000000000000">
Procfile y Despliegue</A>
</H4>
  

<P>
Véase la descripción de los contenidos del Procfile en
<A HREF="#parrafo:procfile">15.1</A>.

<P>

<OL>
<LI>A Procfile is not necessary to deploy apps written in most languages
supported by Heroku. 

<P>
</LI>
<LI>The platform automatically detects the language,
and creates a default web process type to boot the application
server.

<P>
</LI>
<LI>Creating an explicit <code>Procfile</code> is recommended for greater control and flexibility over your app.

<P>
</LI>
<LI>For Heroku to use your Procfile, add the Procfile to the root of your application, then push to Heroku:

<P>
<PRE>
$ git add .
$ git commit -m "Procfile"
$ git push heroku
...
-----&gt; Procfile declares process types: web, worker
       Compiled slug size is 10.4MB
-----&gt; Launching... done
       http://strong-stone-297.herokuapp.com deployed to Heroku

To git@heroku.com:strong-stone-297.git
 * [new branch]      master -&gt; master
</PRE>
</LI>
</OL>

<P>

<H4><A NAME="SECTION061100100000000000000">
Store your app in Git</A>
</H4>
  

<P>
<PRE>
$ git init
$ git add .
$ git commit -m "init"
</PRE>

<P>
<PRE>
[~/sinatra/rockpaperscissors(master)]$ git remote -v
origin  git@github.com:crguezl/sinatra-rock-paper-scissors.git (fetch)
origin  git@github.com:crguezl/sinatra-rock-paper-scissors.git (push)
</PRE>

<P>

<H4><A NAME="SECTION061100110000000000000">
Deploy your application to Heroku</A>
</H4>
  

<P>
Create the app on Heroku:
<PRE>
[~/sinatra/rockpaperscissors(master)]$ heroku create
Creating mysterious-falls-4594... done, stack is cedar
http://mysterious-falls-4594.herokuapp.com/ | git@heroku.com:mysterious-falls-4594.git
Git remote heroku added
</PRE>

<P>
<PRE>
[~/sinatra/rockpaperscissors(spec)]$ cat Rakefile 
desc "start server using rackup ..."
task :default do
  sh "rackup"
end

require 'rspec/core/rake_task'

RSpec::Core::RakeTask.new do |task|
  task.rspec_opts = ["-c", "-f progress"] 
  task.pattern    = 'spec/**/*_spec.rb'
end
</PRE>

<P>
<PRE>
[~/sinatra/rockpaperscissors(master)]$ git remote -v
heroku  git@heroku.com:mysterious-falls-4594.git (fetch)
heroku  git@heroku.com:mysterious-falls-4594.git (push)
origin  git@github.com:crguezl/sinatra-rock-paper-scissors.git (fetch)
origin  git@github.com:crguezl/sinatra-rock-paper-scissors.git (push)
</PRE>

<P>
Deploy your code:

<P>
<PRE>
[~/sinatra/rockpaperscissors(master)]$ git push heroku master
Counting objects: 31, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (29/29), done.
Writing objects: 100% (31/31), 9.09 KiB, done.
Total 31 (delta 11), reused 0 (delta 0)

-----&gt; Ruby/Rack app detected
-----&gt; Installing dependencies using Bundler version 1.3.2
       Running: bundle install --without development:test --path vendor/bundle --binstubs vendor/bundle/bin --deployment
       Fetching gem metadata from https://rubygems.org/..........
       Fetching gem metadata from https://rubygems.org/..
       Installing tilt (1.4.1)
       Installing haml (4.0.3)
       Installing rack (1.5.2)
       Installing puma (2.0.1)
       Installing rack-protection (1.5.0)
       Installing sinatra (1.4.2)
       Using bundler (1.3.2)
       Your bundle is complete! It was installed into ./vendor/bundle
       Post-install message from haml:
       HEADS UP! Haml 4.0 has many improvements, but also has changes that may break
       your application:
       * Support for Ruby 1.8.6 dropped
       * Support for Rails 2 dropped
       * Sass filter now always outputs &lt;style&gt; tags
       * Data attributes are now hyphenated, not underscored
       * html2haml utility moved to the html2haml gem
       * Textile and Maruku filters moved to the haml-contrib gem
       For more info see:
       http://rubydoc.info/github/haml/haml/file/CHANGELOG.md
       Cleaning up the bundler cache.
-----&gt; Discovering process types
       Procfile declares types     -&gt; (none)
       Default types for Ruby/Rack -&gt; console, rake, web

-----&gt; Compiled slug size: 1.3MB
-----&gt; Launching... done, v4
       http://mysterious-falls-4594.herokuapp.com deployed to Heroku

To git@heroku.com:mysterious-falls-4594.git
 * [new branch]      master -&gt; master
[~/sinatra/rockpaperscissors(master)]$
</PRE>

<P>

<H4><A NAME="SECTION061100120000000000000">
Visit your application</A>
</H4>
  

<P>
You’ve deployed your code to Heroku, and specified the process types
in a Procfile. 

<P>
You can now instruct Heroku to execute a process
type. 

<P>
Heroku does this by running the associated command in a dyno
- a lightweight container which is the basic unit of composition
on Heroku.

<P>
Let’s ensure we have one dyno running the web process type:
<PRE>
$ heroku ps:scale web=1
</PRE>
Veamos que dice la ayuda:
<PRE>
$ heroku help ps
Usage: heroku ps

 list processes for an app

Additional commands, type "heroku help COMMAND" for more details:

  ps:restart [PROCESS]           #  ps:restart [PROCESS]
  ps:scale PROCESS1=AMOUNT1 ...  #  ps:scale PROCESS1=AMOUNT1 ...
  ps:stop PROCESS                #  ps:stop PROCESS

$ heroku help ps:scale
Usage: heroku ps:scale PROCESS1=AMOUNT1 ...

 scale processes by the given amount

 Example: heroku ps:scale web=3 worker+1
</PRE>

<P>
You can check the state of the app’s dynos. 
The heroku <code>ps</code> command lists the running dynos of your application:
<PRE>
$ heroku ps
=== web: `bundle exec ruby web.rb -p $PORT`
web.1: up for 9m
</PRE>
Here, one dyno is running.
<PRE>
[~/sinatra/sinatra-rock-paper-scissors/sinatra-rockpaperscissors(master)]$ heroku ps
Process  State        Command                               
-------  -----------  ------------------------------------  
web.1    idle for 8h  bundle exec rackup config.ru -p $P..
</PRE>

<P>
We can now visit the app in our browser with <code>heroku open</code>.
<PRE>
[~/sinatra/rockpaperscissors(master)]$ heroku open
Opening http://mysterious-falls-4594.herokuapp.com/
[~/sinatra/rockpaperscissors(master)]$
</PRE>

<P>

<img src="sinatraenheroku.png">

<P>

<H4><A NAME="SECTION061100130000000000000">
Dyno sleeping and scaling</A>
</H4>
  

<P>

<OL>
<LI>Having only a single 
<FONT COLOR="#ff0000"> web dyno</FONT> running will result in the dyno going
to sleep after one hour of inactivity. 

<P>
</LI>
<LI>This causes a delay of a few
seconds for the first request upon waking. 

<P>
</LI>
<LI>Subsequent requests will
perform normally.

<P>
</LI>
<LI>To avoid this, you can scale to more than one 
<FONT COLOR="#ff0000"> web dyno</FONT>. For example:
<PRE>
$ heroku ps:scale web=2
</PRE>
</LI>
<LI>For each application, Heroku provides 750 free dyno-hours. 

<P>
</LI>
<LI>Running
your app at 2 dynos would exceed this free, monthly allowance, so
let’s scale back:
<PRE>
$ heroku ps:scale web=1
</PRE>
</LI>
</OL>

<P>

<H4><A NAME="SECTION061100140000000000000">
View the logs</A>
</H4>
  

<P>
Heroku treats logs as streams of time-ordered events aggregated
from the output streams of all the dynos running the components of
your application. 

<P>
Heroku’s Logplex provides a single channel for
all of these events.

<P>
View information about your running app using one of the logging commands, heroku logs:
<PRE>
$ heroku logs
2013-03-13T04:10:49+00:00 heroku[web.1]: Starting process with command `bundle exec ruby web.rb -p 25410`
2013-03-13T04:10:50+00:00 app[web.1]: [2013-03-13 04:10:50] INFO  WEBrick 1.3.1
2013-03-13T04:10:50+00:00 app[web.1]: [2013-03-13 04:10:50] INFO  ruby 2.0.0p247 (2013-06-27 revision 41674) [x86_64-linux]
2013-03-13T04:10:50+00:00 app[web.1]: [2013-03-13 04:10:50] INFO  WEBrick::HTTPServer#start: pid=2 port=25410
</PRE>

<P>

<H4><A NAME="SECTION061100150000000000000">

<FONT COLOR="#ff0000"> heroku run bash</FONT></A>
</H4>
  

Heroku allows you to run commands in a <A NAME="16377"></A><SPAN  CLASS="textbf">one-off dyno</SPAN> 
- scripts and
applications that only need to be executed when needed - using the
<code>heroku run</code> command. 

<P>
Since your app is - in general - 
spread across many dynos by the dyno manager, there
is no single place to SSH into. 

<P>

<FONT COLOR="#0000ff"> You deploy and manage apps, not servers</FONT>.

<P>
You can invoke a shell as a 
<FONT COLOR="#0000ff"> one-off dyno</FONT>.

<P>
While the <A NAME="16383"></A><SPAN  CLASS="textbf">web dyno</SPAN> would be defined in the <code>Procfile</code> 
and managed by
the platform, the console and script would only be executed when
needed. These are <A NAME="16385"></A><SPAN  CLASS="textbf">one-off dynos</SPAN>.

<P>
There are differences between 
<FONT COLOR="#0000ff"> one-off dyno</FONT>s (run with heroku run) and formation dynos 

<P>

<OL>
<LI>
<FONT COLOR="#0000ff"> One-off dyno</FONT>s run attached to your terminal, with a character-by-character
TCP connection for <code>STDIN</code> and <code>STDOUT</code>. 
This allows you to use interactive
processes like a console. 
</LI>
<LI>Since <code>STDOUT</code> is going to your terminal, the
only thing recorded in the app’s logs is the startup and shutdown of
the dyno.
</LI>
<LI>
<FONT COLOR="#0000ff"> One-off dyno</FONT>s terminate as soon as you press <code>Ctrl-C</code> or otherwise
disconnect in your local terminal. 
</LI>
<LI>
<FONT COLOR="#0000ff"> One-off dyno</FONT>s never automatically
restart, whether the process ends on its own or whether you manually
disconnect.
</LI>
<LI>
<FONT COLOR="#0000ff"> One-off dyno</FONT>s are named in the scheme <code>run.N</code> 
rather than the scheme <code>&lt;process-type&gt;.N</code>.
</LI>
<LI>
<FONT COLOR="#0000ff"> One-off dyno</FONT>s can never receive HTTP traffic, since the routers only
routes traffic to dynos named <code>web.N</code>.
</LI>
</OL>

<P>
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ heroku run bash
Running `bash` attached to terminal... up, run.2966
~ $ uname -a
Linux 8f9f0a0c-b10d-4cd5-9c1e-8e87067b6be2 3.8.11-ec2 #1 SMP Fri May 3 09:11:15 UTC 2013 x86_64 GNU/Linux
[~/srcPLgrado/pegjscalc(master)]$ heroku run bash
Running `bash` attached to terminal... up, run.2966
~ $ ls -l
total 48
drwx------ 2 u20508 20508 4096 2014-03-24 11:23 bin
-rw------- 1 u20508 20508   42 2014-03-24 11:23 config.ru
-rw------- 1 u20508 20508  258 2014-03-24 11:23 Gemfile
-rw------- 1 u20508 20508 2399 2014-03-24 11:23 Gemfile.lock
-rw------- 1 u20508 20508 1152 2014-03-24 11:23 main.rb
-rw------- 1 u20508 20508   43 2014-03-24 11:23 Procfile
drwx------ 2 u20508 20508 4096 2014-03-24 11:23 public
-rw------- 1 u20508 20508  492 2014-03-24 11:23 Rakefile
-rw------- 1 u20508 20508  421 2014-03-24 11:23 README.md
drwx------ 2 u20508 20508 4096 2014-03-24 11:23 tmp
drwx------ 5 u20508 20508 4096 2014-03-24 11:23 vendor
drwx------ 2 u20508 20508 4096 2014-03-24 11:23 views
</PRE>

<P>
<PRE>
~ $ ls -l tmp/
total 4
-rw------- 1 u20508 20508 242 2014-03-24 11:23 heroku-buildpack-release-step.yml
~ $ ls -l vendor
total 12
drwx------ 4 u20508 20508 4096 2014-03-20 23:33 bundle
drwx------ 2 u20508 20508 4096 2014-03-20 23:33 heroku
drwx------ 6 u20508 20508 4096 2014-03-24 11:23 ruby-2.0.0
</PRE>

<P>
<PRE>
~ $ ls -l bin
total 0
lrwxrwxrwx 1 u20508 20508 28 2014-03-24 15:05 erb -&gt; ../vendor/ruby-2.0.0/bin/erb
lrwxrwxrwx 1 u20508 20508 28 2014-03-24 15:05 gem -&gt; ../vendor/ruby-2.0.0/bin/gem
lrwxrwxrwx 1 u20508 20508 28 2014-03-24 15:05 irb -&gt; ../vendor/ruby-2.0.0/bin/irb
lrwxrwxrwx 1 u20508 20508 29 2014-03-24 15:05 rake -&gt; ../vendor/ruby-2.0.0/bin/rake
lrwxrwxrwx 1 u20508 20508 29 2014-03-24 15:05 rdoc -&gt; ../vendor/ruby-2.0.0/bin/rdoc
lrwxrwxrwx 1 u20508 20508 27 2014-03-24 15:05 ri -&gt; ../vendor/ruby-2.0.0/bin/ri
lrwxrwxrwx 1 u20508 20508 29 2014-03-24 15:05 ruby -&gt; ../vendor/ruby-2.0.0/bin/ruby
lrwxrwxrwx 1 u20508 20508 33 2014-03-24 15:05 ruby.exe -&gt; ../vendor/ruby-2.0.0/bin/ruby.exe
lrwxrwxrwx 1 u20508 20508 31 2014-03-24 15:05 testrb -&gt; ../vendor/ruby-2.0.0/bin/testrb
</PRE>

<P>

<UL>
<LI>The filesystem is ephemeral, and the dyno itself will only live as long as your console session.
</LI>
<LI>When running multiple dynos, apps are distributed across several nodes
by the dyno manager. 

<P>
</LI>
<LI>Access to your app always goes through the routers.
As a result, 
<FONT COLOR="#ff0000"> dynos don’t have static IP addresses</FONT>. 

<P>
</LI>
<LI>While you can never connect to a dyno directly, it is possible to
originate outgoing requests from a dyno. 
However, you can count on the
dyno’s IP address changing as it gets restarted in different places.
</LI>
</UL>

<P>

<H4><A NAME="SECTION061100160000000000000">

<FONT COLOR="#ff0000"> heroku run console</FONT></A>
</H4>
  

<P>

<OL>
<LI>Heroku allows you to run commands in a 
<FONT COLOR="#0000ff"> one-off dyno</FONT> - scripts and
applications that only need to be executed when needed - using the
<code>heroku run</code> command. 

<P>
</LI>
<LI>You can use this to launch an interactive Ruby
shell (<code>bundle exec irb</code>) attached to your local terminal for
experimenting in your app’s environment:
<PRE>
$ heroku run console
Running `console` attached to terminal... up, ps.1
irb(main):001:0&gt;
</PRE>
</LI>
<LI>By default, <code>irb</code> has nothing loaded other than the Ruby standard
library. From here you can require some of your application files.
Or you can do it on the command line:
<PRE>
$ heroku run console -r ./web
</PRE>
</LI>
</OL>

<P>
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ heroku run irb
Running `irb` attached to terminal... up, run.1081
irb(main):001:0&gt; ENV.keys
=&gt; ["DATABASE_URL", "SHLVL", "PORT", "HOME", "HEROKU_POSTGRESQL_BROWN_URL", "PS1", "_", "COLUMNS", "RACK_ENV", "TERM", "PATH", "LANG", "GEM_PATH", "PWD", "LINES", "DYNO"]
irb(main):002:0&gt; ENV["DATABASE_URL"]
=&gt; "postgres://moiwgreelvvujc:GL3shXGOpURyWOPrS2G8qaxzUe@ec2-23-21-101-129.compute-1.amazonaws.com:5432/dat9smslrg6g0a"
irb(main):003:0&gt; ENV["HEROKU_POSTGRESQL_BROWN_URL"]
=&gt; "postgres://moiwgreelvvujc:GL3shXGOpURyWOPrS2G8qaxzUe@ec2-23-21-101-129.compute-1.amazonaws.com:5432/dat9smslrg6g0a"
irb(main):004:0&gt;
</PRE>
Podemos cargar librerías de nuestra aplicación
(véase 
<A NAME="tex2html504"
  HREF="https://github.com/crguezl/pegjscalc">pegjscalc</A>) 
y usarlas.
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ heroku run console
Running `console` attached to terminal... up, run.9013
irb(main):002:0&gt; require './main'
=&gt; true
irb(main):003:0&gt; p = PL0Program.all
=&gt; [#&lt;PL0Program @name="3p2m1" @source="                    3-2-1\r\n          "&gt;, #&lt;PL0Program @name="apbtc" @source="a+b*c"&gt;]
irb(main):005:0&gt; chuchu = PL0Program.first(:name =&gt; "apbtc")
=&gt; #&lt;PL0Program @name="apbtc" @source="a+b*c"&gt;
irb(main):006:0&gt; chuchu.source
=&gt; "a+b*c"
irb(main):007:0&gt; prog = PL0Program.create(:name =&gt; "tata", :source =&gt; "3*a-c")
=&gt; #&lt;PL0Program @name="tata" @source="3*a-c"&gt;
irb(main):008:0&gt;
</PRE>

<P>

<H4><A NAME="SECTION061100170000000000000">
Rake</A>
</H4>
  

<P>
Rake can be run in an attached dyno exactly like the console:
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ heroku run rake -T
Running `rake -T` attached to terminal... up, run.2124
rake clean  # Remove pl0.pegjs
rake sass   # Compile public/styles.scss into public/styles.css using sass
rake test   # tests
rake web    # Compile pl0.pegjs browser version
[~/srcPLgrado/pegjscalc(master)]$ heroku run rake test
Running `rake test` attached to terminal... up, run.2082
Not implemented (yet)
</PRE>

<P>

<H4><A NAME="SECTION061100180000000000000">
Using a SQL database</A>
</H4>
  

<P>
By default, non-Rails apps aren’t given a SQL database. 

<P>
This is
because you might want to use a NoSQL database like 
Redis or CouchDB,
or you don’t need any
database at all. 

<P>
If you need a SQL database for your app, do this:

<OL>
<LI><PRE>
$ heroku addons:add heroku-postgresql:dev
</PRE>
</LI>
<LI>You must also add the Postgres gem to your app in order to use your
database. Add a line to your <code>Gemfile</code> like this:
<PRE>
gem 'pg'
</PRE>
</LI>
<LI>You’ll also want to setup a local PostgreSQL database.
</LI>
</OL>

<P>

<H4><A NAME="SECTION061100190000000000000">
Webserver</A>
</H4>
  

<P>
By default your app (Rack) will use <code>Webrick</code>. 

<P>
This is fine for
testing, but for production apps you’ll want to switch to a more
robust webserver. 

<P>
On Cedar, they  recommend <code>Unicorn</code> as the webserver.

<P>

<DIV CLASS="navigation"><HR>
<A NAME="tex2html3585"
  HREF="node97.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html3579"
  HREF="node95.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html3573"
  HREF="node95.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html3581"
  HREF="node120.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html3583"
  HREF="node123.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~plgrado/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1213m2/course/view.php?id=271"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="http://crguezl.github.io/pl-html/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html7"
  HREF="https://developer.mozilla.org/es/docs/JavaScript"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html8"
  HREF="http://github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html9"
  HREF="https://plus.google.com/u/0/communities/107031495100582318205"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1314"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.ull.es/view/centros/etsii/Grado/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html3586"
  HREF="node97.html">Logging</A>
<B>Sup:</B> <A NAME="tex2html3580"
  HREF="node95.html">Heroku</A>
<B> Ant:</B> <A NAME="tex2html3574"
  HREF="node95.html">Heroku</A>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2014-03-26</I>
</ADDRESS>
</BODY>
</HTML>
