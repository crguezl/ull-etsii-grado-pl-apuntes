<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Vistas</TITLE>
<META NAME="description" CONTENT="Vistas">
<META NAME="keywords" CONTENT="javascriptexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node145.html">
<LINK REL="previous" HREF="node143.html">
<LINK REL="up" HREF="node140.html">
<LINK REL="next" HREF="node145.html">
</HEAD>

<BODY >

<DIV CLASS="navigation">
<A NAME="tex2html5240"
  HREF="node145.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html5234"
  HREF="node140.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html5228"
  HREF="node143.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html5236"
  HREF="node228.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html5238"
  HREF="node231.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~plgrado/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1213m2/course/view.php?id=271"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="http://crguezl.github.io/pl-html/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html7"
  HREF="https://developer.mozilla.org/es/docs/JavaScript"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html8"
  HREF="http://github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html9"
  HREF="https://plus.google.com/u/0/communities/107031495100582318205"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1314"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.ull.es/view/centros/etsii/Grado/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html5241"
  HREF="node145.html">Filtros</A>
<B>Sup:</B> <A NAME="tex2html5235"
  HREF="node140.html">Fundamentos</A>
<B> Ant:</B> <A NAME="tex2html5229"
  HREF="node143.html">Ficheros Estáticos</A>
<B> Con:</B> 
<A NAME="tex2html5236"
  HREF="node228.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>
<B> Ind:</B> 
<A NAME="tex2html5238"
  HREF="node231.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A>
<BR> <P>
</DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A NAME="tex2html5242"
  HREF="node144.html#SECTION06341000000000000000">Templates Inline</A>
<LI><A NAME="tex2html5243"
  HREF="node144.html#SECTION06342000000000000000">Named Templates</A>
<LI><A NAME="tex2html5244"
  HREF="node144.html#SECTION06343000000000000000">Templates Externos</A>
<LI><A NAME="tex2html5245"
  HREF="node144.html#SECTION06344000000000000000">Templates Externos en Subcarpetas</A>
<LI><A NAME="tex2html5246"
  HREF="node144.html#SECTION06345000000000000000">Variables en las Vistas</A>
<UL>
<LI><A NAME="tex2html5247"
  HREF="node144.html#SECTION06345010000000000000">Comunicación vía variables de instancia</A>
</UL>
<BR>
<LI><A NAME="tex2html5248"
  HREF="node144.html#SECTION06346000000000000000">Pasando variables a la vista explícitamente via un hash</A>
<LI><A NAME="tex2html5249"
  HREF="node144.html#SECTION06347000000000000000">Opciones pasadas a los Métodos de los Templates</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION06340000000000000000">
Vistas</A>
</H1>

<P>
<BLOCKQUOTE>
Writing a program that spits out HTML is often more difficult than
you might imagine. Although programming languages are better at
creating text than they used to be (some of us remember character
handling in Fortran and standard Pascal), creating and concatenating
string constructs is still painful. If there isn't much to do, it
isn't too bad, but a whole HTML page is a lot of text manipulation.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>With static HTML pages - those that don't change from request to
request - you can use nice WYSIWG editors. Even those of us who
like raw text editors find it easier to just type in the text and
tags rather than fiddle with string concatenation in a programming
language.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>Of course the issue is with dynamic Web pages - those that take the
results of something like database queries and embed them into the
HTML. The page looks different with each result, and as a result
regular HTML editors aren't up to the job.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>The best way to work is to compose the dynamic Web page as you do
a static page but put in markers that can be resolved into calls
to gather dynamic information. Since the static part of the page
acts as a template for the particular response, I call this a
<A NAME="20250"></A><SPAN  CLASS="textbf">Template View</SPAN>.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
<DIV ALIGN="RIGHT">Martin Fowler
</BLOCKQUOTE>
<P>

<P>
Views in Sinatra  are <A NAME="20252"></A><SPAN  CLASS="textbf">HTML templates</SPAN> that can optionally contain data
passed from the application.

<P>
There are two ways to work with views in Sinatra: <A NAME="20254"></A><SPAN  CLASS="textbf">inline templates</SPAN> and
<A NAME="20256"></A><SPAN  CLASS="textbf">external templates</SPAN>.

<P>
Véase en GitHub 
<A NAME="tex2html683"
  HREF="https://github.com/crguezl/sinatra-up-and-running/tree/master/chapter2/views">sinatra-up-and-running/tree/master/chapter2/views</A>.

<P>

<H2><A NAME="SECTION06341000000000000000">
Templates Inline</A>
</H2>

<P>
Templates may be defined at the end of the source file.
En este ejemplo trabajamos con varios templates inline en diferentes ficheros:
<PRE>
[~/sinatra/sinatraupandrunning/chapter2/views(master)]$ cat example2-14.rb 
require 'sinatra/base'

class App &lt; Sinatra::Base
  enable :inline_templates
  get '/index' do 
    puts "Visiting #{request.url}"
    erb :index
  end
end

require './another'
__END__
@@index
&lt;!DOCTYPE html&gt;
&lt;html&gt; 
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Inline template&lt;/title&gt; 
  &lt;/head&gt;
  &lt;body&gt; 
    &lt;h1&gt;Worked!&lt;/h1&gt;
  &lt;/body&gt; 
&lt;/html&gt;
</PRE>

<P>
En este fichero tenemos un segundo template inline:
<PRE>
[~/sinatra/sinatraupandrunning/chapter2/views(master)]$ cat another.rb 
class App 
  enable :inline_templates
  get '/' do
    erb :another
  end
end

__END__
@@another
&lt;!DOCTYPE html&gt;
&lt;html&gt; 
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Separated file&lt;/title&gt; 
  &lt;/head&gt;
  &lt;body&gt; 
    &lt;h1&gt;Inside another!&lt;/h1&gt;
  &lt;/body&gt; 
&lt;/html&gt;
</PRE>

<P>
Este es nuestro config.ru:

<P>
<PRE>
[~/sinatra/sinatraupandrunning/chapter2/views(master)]$ cat config.ru 
require './example2-14'

run App
</PRE>
Para simplificar las cosas hemos hecho un <code>Rakefile</code>:
<PRE>
[~/sinatra/sinatraupandrunning/chapter2/views(master)]$ cat Rakefile 
task :default =&gt; :server

desc "run server"
task :server do
  sh "rackup"
end

desc "make a get / request via curl"
task :root do
  sh "curl -v localhost:9292"
end

desc "make a get /index request via curl"
task :index do 
  sh "curl -v localhost:9292/index"
end
</PRE>

<P>
El resultado de la ejecución es:
<PRE>
[~/sinatra/sinatra-up-and-running/chapter2/views/inline_templates(master)]$ curl http://localhost:9292/index
&lt;!DOCTYPE html&gt;
&lt;html&gt; 
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Inline template&lt;/title&gt; 
  &lt;/head&gt;
  &lt;body&gt; 
    &lt;h1&gt;Worked!&lt;/h1&gt;
  &lt;/body&gt; 
&lt;/html&gt;
[~/sinatra/sinatra-up-and-running/chapter2/views/inline_templates(master)]$ curl http://localhost:9292/
&lt;!DOCTYPE html&gt;
&lt;html&gt; 
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Separated file&lt;/title&gt; 
  &lt;/head&gt;
  &lt;body&gt; 
    &lt;h1&gt;Inside another!&lt;/h1&gt;
  &lt;/body&gt; 
&lt;/html&gt;
</PRE>

<P>

<H2><A NAME="SECTION06342000000000000000">
Named Templates</A>
</H2>
Templates may also be defined using the top-level <code>template</code> method:

<P>
<PRE>
template :layout do
  "%html\n  =yield\n"
end

template :index do
  '%div.title Hello World!'
end

get '/' do
  haml :index
end
</PRE>
If a template named <code>layout</code> exists, it will be used each time a template is rendered. 

<P>
You can individually disable layouts by passing <code>:layout =&gt; false</code> or disable them by default via <code>set :haml, :layout =&gt; false</code>:

<P>
<PRE>
get '/' do
  haml :index, :layout =&gt; !request.xhr?
end
</PRE>

<P>

<H2><A NAME="SECTION06343000000000000000">
Templates Externos</A>
</H2>

<P>
<PRE>
$ ls
Rakefile               example2-16.rb         views
config.ru
</PRE>

<P>
<PRE>
$ cat example2-16.rb 
require 'sinatra/base'

class App &lt; Sinatra::Base
  get '/index' do 
    puts "Visiting #{request.url}"
    erb :index
  end
end
</PRE>

<P>
<PRE>
$ cat views/index.erb 
&lt;!DOCTYPE html&gt;
&lt;html&gt; 
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Inline template&lt;/title&gt; 
  &lt;/head&gt;
  &lt;body&gt; 
    &lt;h1&gt;Worked!&lt;/h1&gt;
  &lt;/body&gt; 
&lt;/html&gt;
</PRE>

<P>
<PRE>
$ cat config.ru 
require './example2-16'

run App
</PRE>

<P>
<PRE>
$ cat Rakefile 
task :default =&gt; :server

desc "run server"
task :server do
  sh "rackup"
end

desc "make a get / request via curl"
task :root do
  sh "curl -v localhost:9292"
end

desc "make a get /index request via curl"
task :index do 
  sh "curl -v localhost:9292/index"
end
</PRE>

<P>
<PRE>
$ rake server
rackup
&gt;&gt; Thin web server (v1.5.1 codename Straight Razor)
&gt;&gt; Maximum connections set to 1024
&gt;&gt; Listening on 0.0.0.0:9292, CTRL+C to stop
Visiting http://localhost:9292/index
127.0.0.1 - - [03/Jul/2013 22:30:16] "GET /index HTTP/1.1" 200 157 0.0774
</PRE>

<P>
<PRE>
$ rake index
curl -v localhost:9292/index
* About to connect() to localhost port 9292 (#0)
*   Trying 127.0.0.1... connected
* Connected to localhost (127.0.0.1) port 9292 (#0)
&gt; GET /index HTTP/1.1
&gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4 OpenSSL/0.9.8x zlib/1.2.5
&gt; Host: localhost:9292
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html;charset=utf-8
&lt; Content-Length: 157
&lt; X-XSS-Protection: 1; mode=block
&lt; X-Content-Type-Options: nosniff
&lt; X-Frame-Options: SAMEORIGIN
&lt; Connection: keep-alive
&lt; Server: thin 1.5.1 codename Straight Razor
&lt; 
&lt;!DOCTYPE html&gt;
&lt;html&gt; 
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Inline template&lt;/title&gt; 
  &lt;/head&gt;
  &lt;body&gt; 
    &lt;h1&gt;Worked!&lt;/h1&gt;
  &lt;/body&gt; 
&lt;/html&gt;

* Connection #0 to host localhost left intact
* Closing connection #0
</PRE>

<P>

<H2><A NAME="SECTION06344000000000000000">
Templates Externos en Subcarpetas</A>
</H2>

<P>
Véase en GitHub 
<A NAME="tex2html684"
  HREF="https://github.com/crguezl/sinatra-up-and-running/tree/master/chapter2/views/external_view_files/external_in_subfolders">sinatra-up-and-running/tree/master/chapter2/views/external_view_files/external_in_subfolders</A>
<P>
<PRE>
$ ls
Rakefile  app.rb    config.ru views
</PRE>

<P>
<PRE>
$ cat app.rb 
require 'sinatra/base'

class App &lt; Sinatra::Base
  get '/:user/profile' do |user|
    @user = user
    erb '/user/profile'.to_sym
  end

  get '/:user/help' do |user|
    @user = user
    erb :'/user/help'
  end
end
</PRE>

<P>
<PRE>
$ cat views/user/profile.erb 
&lt;!DOCTYPE html&gt;
&lt;html&gt; 
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Profile Template&lt;/title&gt; 
  &lt;/head&gt;
  &lt;body&gt; 
    &lt;h1&gt;Profile of &lt;%= @user %&gt;&lt;/h1&gt;
     &lt;%= params %&gt;
  &lt;/body&gt; 
&lt;/html&gt;
</PRE>

<P>
<PRE>
$ cat views/user/help.erb 
&lt;!DOCTYPE html&gt;
&lt;html&gt; 
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;HELP Template&lt;/title&gt; 
  &lt;/head&gt;
  &lt;body&gt; 
    &lt;h1&gt;Help for user &lt;%= @user %&gt;&lt;/h1&gt;
     &lt;pre&gt;
       &lt;%= params %&gt;
     &lt;/pre&gt;
  &lt;/body&gt; 
&lt;/html&gt;
</PRE>

<P>
<PRE>
$ cat config.ru 
require './app'

run App
</PRE>

<P>
<PRE>
$ cat Rakefile 
PORT = 9292
task :default =&gt; :server

desc "run server"
task :server do
  sh "rackup"
end

desc "make a get /pepe/profile request via curl"
task :profile, :name do |t, h|
  user = h['name'] || 'pepe'
  sh "curl -v localhost:#{PORT}/#{user}/profile"
end

desc "make a get /pepe/help request via curl"
task :help do 
  sh "curl -v localhost:#{PORT}/pepe/help"
end
</PRE>

<P>
<PRE>
$ rake server
rackup
&gt;&gt; Thin web server (v1.5.1 codename Straight Razor)
&gt;&gt; Maximum connections set to 1024
&gt;&gt; Listening on 0.0.0.0:9292, CTRL+C to stop
127.0.0.1 - - [03/Jul/2013 21:40:04] "GET /Pedro/profile HTTP/1.1" 200 227 0.1077
</PRE>

<P>
<PRE>
$ rake profile[Pedro]
curl -v localhost:9292/Pedro/profile
* About to connect() to localhost port 9292 (#0)
*   Trying 127.0.0.1... connected
* Connected to localhost (127.0.0.1) port 9292 (#0)
&gt; GET /Pedro/profile HTTP/1.1
&gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4 OpenSSL/0.9.8x zlib/1.2.5
&gt; Host: localhost:9292
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html;charset=utf-8
&lt; Content-Length: 227
&lt; X-XSS-Protection: 1; mode=block
&lt; X-Content-Type-Options: nosniff
&lt; X-Frame-Options: SAMEORIGIN
&lt; Connection: keep-alive
&lt; Server: thin 1.5.1 codename Straight Razor
&lt; 
&lt;!DOCTYPE html&gt;
&lt;html&gt; 
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Profile Template&lt;/title&gt; 
  &lt;/head&gt;
  &lt;body&gt; 
    &lt;h1&gt;Profile of Pedro&lt;/h1&gt;
     {"splat"=&gt;[], "captures"=&gt;["Pedro"], "user"=&gt;"Pedro"}
  &lt;/body&gt; 
&lt;/html&gt;


* Connection #0 to host localhost left intact
* Closing connection #0
</PRE>

<P>

<H2><A NAME="SECTION06345000000000000000">
Variables en las Vistas</A>
</H2>

<P>

<H4><A NAME="SECTION06345010000000000000">
Comunicación vía variables de instancia</A>
</H4>
  

Los templates se evaluan en el mismo contexto que los manejadores de las rutas.
Las variables de instancia son accesibles directamente en los templates.

<P>
<PRE>
get '/:id' do
  @foo = Foo.find(params[:id])
  haml '%h1= @foo.name'
end
</PRE>
Veamos un ejemplo de comunicación via variables de instancia entre el manejador de la ruta
y el template:

<P>
<PRE>
[~/sinatra/sinatra-views/passing_data_into_views(master)]$ ls
Rakefile        config.ru       via_instance.rb
</PRE>

<P>
<PRE>
[~/sinatra/sinatra-views/passing_data_into_views(master)]$ cat via_instance.rb 
require 'sinatra/base'


class App &lt; Sinatra::Base
  get '/*' do |name|
    def some_template
       &lt;&lt;-'HAMLTEMP'
%ol
  - @foo.each do |item|
    %li 
      %i #{item}
HAMLTEMP
    end

    puts "*---***#{name}*---****"
    @foo = name.split('/')
    haml some_template
  end
end
</PRE>

<P>
<PRE>
[~/sinatra/sinatra-views/passing_data_into_views(master)]$ cat config.ru 
require './via_instance'

run App
</PRE>

<P>
<PRE>
[~/sinatra/sinatra-views/passing_data_into_views(master)]$ cat Rakefile 
task :default =&gt; :server

desc "run server"
task :server do
  sh "rackup"
end

desc "make a get /juan/leon/hernandez request via curl"
task :client do
  sh "curl -v localhost:9292/juan/leon/hernandez"
end
</PRE>

<P>
<PRE>
[~/sinatra/sinatraupandrunning/chapter2/views/passing_data_into_views(master)]$ rake server
rackup
&gt;&gt; Thin web server (v1.5.1 codename Straight Razor)
&gt;&gt; Maximum connections set to 1024
&gt;&gt; Listening on 0.0.0.0:9292, CTRL+C to stop
*---***juan/leon/hernandez*---****
127.0.0.1 - - [05/Jul/2013 17:06:05] "GET /juan/leon/hernandez HTTP/1.1" 200 109 0.3502
</PRE>

<P>
<PRE>
[~/sinatra/sinatra-views/passing_data_into_views(master)]$ rake client
curl -v localhost:9292/juan/leon/hernandez
* About to connect() to localhost port 9292 (#0)
*   Trying 127.0.0.1... connected
* Connected to localhost (127.0.0.1) port 9292 (#0)
&gt; GET /juan/leon/hernandez HTTP/1.1
&gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4 OpenSSL/0.9.8x zlib/1.2.5
&gt; Host: localhost:9292
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html;charset=utf-8
&lt; Content-Length: 109
&lt; X-XSS-Protection: 1; mode=block
&lt; X-Content-Type-Options: nosniff
&lt; X-Frame-Options: SAMEORIGIN
&lt; Connection: keep-alive
&lt; Server: thin 1.5.1 codename Straight Razor
&lt; 
&lt;ol&gt;
  &lt;li&gt;
    &lt;i&gt;juan&lt;/i&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;i&gt;leon&lt;/i&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;i&gt;hernandez&lt;/i&gt;
  &lt;/li&gt;
&lt;/ol&gt;
* Connection #0 to host localhost left intact
* Closing connection #0
</PRE>

<P>

<H2><A NAME="SECTION06346000000000000000">
Pasando variables a la vista explícitamente via un hash</A>
</H2>

<P>
También es posible pasar en la llamada un hash especificando 
las variables locales:
<PRE>
get '/:id' do
  foo = Foo.find(params[:id])
  haml '%h1= bar.name', :locals =&gt; { :bar =&gt; foo }
end
</PRE>
This is typically used when rendering templates as partials from within other templates.

<P>
Veamos un ejemplo:

<P>
<PRE>
$ ls
Rakefile    config.ru   via_hash.rb views
</PRE>

<P>
<PRE>
$ cat via_hash.rb
require 'sinatra/base'

class App &lt; Sinatra::Base
  get '/*' do |name|
    def some_template
       &lt;&lt;-'ERBTEMP'
&lt;ul&gt;&lt;% name.each do |item| %&gt;
      &lt;li&gt; &lt;i&gt; &lt;%= item %&gt; &lt;/i&gt; &lt;/li&gt;
    &lt;% end %&gt;
&lt;/ul&gt;
ERBTEMP
    end # method some_template

    puts "*---***#{name}*---****"
    erb some_template, :locals =&gt; { :name =&gt; name.split('/')}
  end
end
</PRE>

<P>
<PRE>
$ cat views/layout.erb 
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
        &lt;title&gt;Sinatra&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Accesing variables in templates via a parameter hash&lt;/h1&gt;
    &lt;%= yield %&gt;
  &lt;/body&gt;
&lt;/html&gt;
</PRE>

<P>
<PRE>
$ cat config.ru 
require './via_hash'

run App
</PRE>

<P>
<PRE>
$ cat Rakefile task :default =&gt; :server

desc "run server"
task :server do
  sh "rackup"
end

desc "make a get /juan/leon/hernandez request via curl"
task :client do
  sh "curl -v localhost:9292/juan/leon/hernandez"
end
</PRE>

<P>
<PRE>
$ rake serverrackup
&gt;&gt; Thin web server (v1.5.1 codename Straight Razor)
&gt;&gt; Maximum connections set to 1024
&gt;&gt; Listening on 0.0.0.0:9292, CTRL+C to stop
*---***juan/leon/hernandez*---****
127.0.0.1 - - [05/Jul/2013 17:50:20] "GET /juan/leon/hernandez HTTP/1.1" 200 290 0.0352
</PRE>

<P>
<PRE>
$ rake client
curl -v localhost:9292/juan/leon/hernandez
* About to connect() to localhost port 9292 (#0)
*   Trying 127.0.0.1... connected
* Connected to localhost (127.0.0.1) port 9292 (#0)
&gt; GET /juan/leon/hernandez HTTP/1.1
&gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4 OpenSSL/0.9.8x zlib/1.2.5
&gt; Host: localhost:9292
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/html;charset=utf-8
&lt; Content-Length: 290
&lt; X-XSS-Protection: 1; mode=block
&lt; X-Content-Type-Options: nosniff
&lt; X-Frame-Options: SAMEORIGIN
&lt; Connection: keep-alive
&lt; Server: thin 1.5.1 codename Straight Razor
&lt; 
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
        &lt;title&gt;Sinatra&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Accesing variables in templates via a parameter hash&lt;/h1&gt;
    &lt;ul&gt;
      &lt;li&gt; &lt;i&gt; juan &lt;/i&gt; &lt;/li&gt;
    
      &lt;li&gt; &lt;i&gt; leon &lt;/i&gt; &lt;/li&gt;
    
      &lt;li&gt; &lt;i&gt; hernandez &lt;/i&gt; &lt;/li&gt;
    
&lt;/ul&gt;

  &lt;/body&gt;
&lt;/html&gt;
* Connection #0 to host localhost left intact
* Closing connection #0
</PRE>

<P>

<H2><A NAME="SECTION06347000000000000000">
Opciones pasadas a los Métodos de los Templates</A>
</H2>

<P>
Options passed to the render method override options set via <code>set</code>.

<P>
Available Options:

<P>

<OL>
<LI><code>locals</code>

<P>
List of locals passed to the document. Handy with partials. Example: 
<PRE>
erb "&lt;%= foo %&gt;", :locals =&gt; {:foo =&gt; "bar"}
</PRE>
</LI>
<LI><code>default_encoding</code>

<P>
String encoding to use if uncertain. Defaults to 
<PRE>
settings.default_encoding.
</PRE>

<P>
</LI>
<LI><code>views</code>

<P>
Views folder to load templates from. Defaults to <code>settings.views</code>.

<P>
</LI>
<LI><code>layout</code>

<P>
Whether to use a layout (true or false), if it's a Symbol, specifies what template to use. Example: 
<PRE>
erb :index, :layout =&gt; !request.xhr?
</PRE>

<P>
</LI>
<LI><code>content_type</code>

<P>
Content-Type the template produces, default depends on template language.

<P>
</LI>
<LI><code>scope</code>

<P>
Scope to render template under. 

<P>
Defaults to the application instance. 

<P>
If you change this, instance variables and helper methods will not be available.

<P>
</LI>
<LI><code>layout_engine</code>

<P>
Template engine to use for rendering the layout. 

<P>
Useful for languages
that do not support layouts otherwise. 

<P>
Defaults to the engine used
for the template. Example: 

<P>
<PRE>
set :rdoc, :layout_engine =&gt; :erb
</PRE>

<P>
</LI>
<LI><code>layout_options</code>

<P>
Special options only used for rendering the layout. Example: 

<P>
<PRE>
set :rdoc, :layout_options =&gt; { :views =&gt; 'views/layouts' }
</PRE>

<P>
</LI>
<LI>Templates are assumed to be located directly under the <code>./views</code> directory. 

<P>
To use a different views directory: 

<P>
<PRE>
set :views, settings.root + '/templates'
</PRE>

<P>
</LI>
<LI>One important thing to remember is that you always have to reference
templates with symbols, even if they’re in a subdirectory (in this
case, use: 
<code>:'subdir/template'</code> 
or 
<code>'subdir/template'.to_sym</code>). 

<P>
You
must use a symbol because otherwise rendering methods will render
any strings passed to them directly.
</LI>
</OL>

<P>

<DIV CLASS="navigation"><HR>
<A NAME="tex2html5240"
  HREF="node145.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html5234"
  HREF="node140.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html5228"
  HREF="node143.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html5236"
  HREF="node228.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html5238"
  HREF="node231.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~plgrado/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1213m2/course/view.php?id=271"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="http://crguezl.github.io/pl-html/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html7"
  HREF="https://developer.mozilla.org/es/docs/JavaScript"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html8"
  HREF="http://github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html9"
  HREF="https://plus.google.com/u/0/communities/107031495100582318205"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1314"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.ull.es/view/centros/etsii/Grado/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html5241"
  HREF="node145.html">Filtros</A>
<B>Sup:</B> <A NAME="tex2html5235"
  HREF="node140.html">Fundamentos</A>
<B> Ant:</B> <A NAME="tex2html5229"
  HREF="node143.html">Ficheros Estáticos</A>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2014-04-26</I>
</ADDRESS>
</BODY>
</HTML>
