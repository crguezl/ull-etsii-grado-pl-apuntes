<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Heroku Postgress</TITLE>
<META NAME="description" CONTENT="Heroku Postgress">
<META NAME="keywords" CONTENT="javascriptexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node196.html">
<LINK REL="previous" HREF="node194.html">
<LINK REL="up" HREF="node192.html">
<LINK REL="next" HREF="node196.html">
</HEAD>

<BODY >

<DIV CLASS="navigation">
<A NAME="tex2html6137"
  HREF="node196.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html6131"
  HREF="node192.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html6125"
  HREF="node194.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html6133"
  HREF="node227.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html6135"
  HREF="node230.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~plgrado/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1213m2/course/view.php?id=271"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="http://crguezl.github.io/pl-html/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html7"
  HREF="https://developer.mozilla.org/es/docs/JavaScript"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html8"
  HREF="http://github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html9"
  HREF="https://plus.google.com/u/0/communities/107031495100582318205"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1314"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.ull.es/view/centros/etsii/Grado/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html6138"
  HREF="node196.html">Troubleshooting</A>
<B>Sup:</B> <A NAME="tex2html6132"
  HREF="node192.html">Heroku</A>
<B> Ant:</B> <A NAME="tex2html6126"
  HREF="node194.html">Logging</A>
<B> Con:</B> 
<A NAME="tex2html6133"
  HREF="node227.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>
<B> Ind:</B> 
<A NAME="tex2html6135"
  HREF="node230.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A>
<BR> <P>
</DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html6139"
  HREF="node195.html#SECTION07130010000000000000">Provisioning the add-on</A>
<LI><A NAME="tex2html6140"
  HREF="node195.html#SECTION07130020000000000000">Create new db</A>
<LI><A NAME="tex2html6141"
  HREF="node195.html#SECTION07130030000000000000">Establish primary DB</A>
<LI><A NAME="tex2html6142"
  HREF="node195.html#SECTION07130040000000000000">pg:info</A>
<LI><A NAME="tex2html6143"
  HREF="node195.html#SECTION07130050000000000000">pg:psql</A>
<LI><A NAME="tex2html6144"
  HREF="node195.html#SECTION07130060000000000000">pg:reset</A>
<LI><A NAME="tex2html6145"
  HREF="node195.html#SECTION07130070000000000000">pg:pull</A>
<LI><A NAME="tex2html6146"
  HREF="node195.html#SECTION07130080000000000000">pg:push</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION07130000000000000000">
Heroku Postgress</A>
</H1>

<P>
Véase <A NAME="tex2html771"
  HREF="https://devcenter.heroku.com/articles/heroku-postgresql">Heroku Postgress</A>.

<P>
Heroku Postgres is the SQL database service run by Heroku that is
provisioned and managed as an add-on. 

<P>
Heroku Postgres is accessible
from any language with a PostgreSQL driver including all languages
and frameworks supported by Heroku: Java, Ruby, Python, Scala, Play,
Node.js and Clojure.

<P>
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ heroku addons
=== pegjspl0 Configured Add-ons
heroku-postgresql:hobby-dev  HEROKU_POSTGRESQL_BROWN
</PRE>

<P>
In addition to a variety of management commands available via the Heroku
CLI, Heroku Postgres features a 
<A NAME="tex2html772"
  HREF="https://postgres.heroku.com/databases">web dashboard</A>, 
the ability to create
<A NAME="tex2html773"
  HREF="https://postgres.heroku.com/blog/past/2012/1/31/simple_data_sharing_with_data_clips/">dataclips </A>
and several additional services on top of a fully managed
database service.

<P>

<img src="herokudatabases.png" />

<P>

<H4><A NAME="SECTION07130010000000000000">
Provisioning the add-on</A>
</H4>
  

Many 
<A NAME="tex2html775"
  HREF="https://devcenter.heroku.com/articles/buildpacks">buildpacks </A>
(what compiles your application into a runnable entity on
Heroku) automatically provision a 
<FONT COLOR="#ff0000"> Heroku Postgres instance for you</FONT>. 

<P>
Your
language’s buildpack documentation will specify if any add-ons are
automatically provisioned. 

<P>
Additionally, you can use <code>heroku addons</code> 
to
see if your application already has a database provisioned and what plan
it is<A NAME="tex2html774"
  HREF="footnode.html#foot22328"><SUP><SPAN CLASS="arabic">30</SPAN>.<SPAN CLASS="arabic">2</SPAN></SUP></A>.

<P>
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ heroku addons
=== pegjspl0 Configured Add-ons
heroku-postgresql:hobby-dev  HEROKU_POSTGRESQL_BROWN
</PRE>

<P>
If your application doesn’t yet have a database provisioned, or you
wish to 
<A NAME="tex2html776"
  HREF="https://devcenter.heroku.com/articles/upgrade-heroku-postgres-with-pgbackups">upgrade your existing database</A>
or 
<A NAME="tex2html777"
  HREF="https://devcenter.heroku.com/articles/heroku-postgres-follower-databases">create a master/slave setup,</A>
you can create a new database using the CLI.

<P>

<H4><A NAME="SECTION07130020000000000000">
Create new db</A>
</H4>
  

Heroku Postgres can be attached to a Heroku application via the 
CLI<A NAME="tex2html778"
  HREF="footnode.html#foot22336"><SUP><SPAN CLASS="arabic">30</SPAN>.<SPAN CLASS="arabic">3</SPAN></SUP></A>:
<PRE>
$ heroku addons:add heroku-postgresql:dev
Adding heroku-postgresql:dev to sushi... done, v69 (free)
Attached as HEROKU_POSTGRESQL_RED
Database has been created and is available
</PRE>

<P>
Once Heroku Postgres has been added a <code>HEROKU_POSTGRESQL_COLOR_URL</code> 
setting
will be available in the app configuration and will contain the URL
used to access the newly provisioned Heroku Postgres service. 

<P>
This can
be confirmed using the <code>heroku config</code> command.
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ heroku config
=== pegjspl0 Config Vars
DATABASE_URL:                postgres://moiwgreelvvujc:GL3shXGOpURyWOPrS2G8qaxzUe@ec2-23-21-101-129.compute-1.amazonaws.com:5432/dat9smslrg6g0a
HEROKU_POSTGRESQL_BROWN_URL: postgres://moiwgreelvvujc:GL3shXGOpURyWOPrS2G8qaxzUe@ec2-23-21-101-129.compute-1.amazonaws.com:5432/dat9smslrg6g0a
LANG:                        en_US.UTF-8
PGBACKUPS_URL:               https://453643:cqz59jrxbbfcxj0fanhjfg0vz@pgbackups.herokuapp.com/client
RACK_ENV:                    production
</PRE>

<P>

<H4><A NAME="SECTION07130030000000000000">
Establish primary DB</A>
</H4>
  

<P>
Heroku recommends using the <code>DATABASE_URL</code> config var to store
the location
of your primary database. 
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ head main.rb 
require 'sinatra'
require "sinatra/reloader" if development?
require 'sinatra/flash'
require 'data_mapper'
require 'pp'

# full path!
DataMapper.setup(:default, 
                 ENV['DATABASE_URL'] || "sqlite3://#{Dir.pwd}/database.db" )
</PRE>

<P>
In single-database setups your new database
will have already been assigned a <code>HEROKU_POSTGRESQL_COLOR_URL</code>
config with
the accompanying <code>DATABASE_URL</code>. 

<P>
You may verify this via heroku config and
verifying the value of both <code>HEROKU_POSTGRESQL_COLOR_URL</code> 
and <code>DATABASE_URL</code>
which should match.

<P>

<H4><A NAME="SECTION07130040000000000000">
pg:info</A>
</H4>
  

<P>
To see all PostgreSQL databases provisioned by your application and the
identifying characteristics of each 
(db size, status, number of tables, PG version, creation date etc…) 
use the <code>heroku pg:info</code> command.

<P>
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ heroku pg:info
=== HEROKU_POSTGRESQL_BROWN_URL (DATABASE_URL)
Plan:        Hobby-dev
Status:      available
Connections: 0
PG Version:  9.3.3
Created:     2014-03-20 23:33 UTC
Data Size:   6.5 MB
Tables:      1
Rows:        4/10000 (In compliance)
Fork/Follow: Unsupported
Rollback:    Unsupported
</PRE>

<P>
To continuously monitor the status of your database, pass pg:info through the unix watch command:
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ watch heroku pg:info
-bash: watch: no se encontró la orden
[~/srcPLgrado/pegjscalc(master)]$ brew install watch
[~/srcPLgrado/pegjscalc(master)]$ watch heroku pg:info
...
</PRE>

<P>

<H4><A NAME="SECTION07130050000000000000">
pg:psql</A>
</H4>
  

<code>psql</code> is the native PostgreSQL interactive terminal and is used to execute queries and issue commands to the connected database.

<P>
To establish a <code>psql</code> session 
with your remote database use <code>heroku pg:psql</code>.
You must have PostgreSQL installed on your system to use heroku <code>pg:psql</code>.

<P>
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ heroku pg:psql
---&gt; Connecting to HEROKU_POSTGRESQL_BROWN_URL (DATABASE_URL)
psql (9.2.6, server 9.3.3)
WARNING: psql version 9.2, server version 9.3.
         Some psql features might not work.
SSL connection (cipher: DHE-RSA-AES256-SHA, bits: 256)
Type "help" for help.

pegjspl0::BROWN=&gt; \dt
               List of relations
 Schema |     Name     | Type  |     Owner      
--------+--------------+-------+----------------
 public | pl0_programs | table | moiwgreelvvujc
(1 row)

pegjspl0::BROWN=&gt; 
pegjspl0::BROWN=&gt; SELECT * FROM pl0_programs;
  name  |           source            
--------+-----------------------------
 3m2m1  |                     3-2-1\r+
        |           
 ap1tb  | a+1*b\r                    +
        |           
 test   |                     a+1*b\r+
        |           \r               +
        |           
 lolwut |                     3-2-1\r+
        |           
(4 rows)
</PRE>

<P>
If you have more than one database, specify the database to connect to as
the first argument to the command (the database located at <code>DATABASE_URL</code>
is used by default).
<PRE>
$ heroku pg:psql HEROKU_POSTGRESQL_GRAY
Connecting to HEROKU_POSTGRESQL_GRAY... done
...
</PRE>

<P>

<H4><A NAME="SECTION07130060000000000000">
pg:reset</A>
</H4>
  

 To drop and recreate your database use <code>pg:reset</code>:

<P>
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ heroku pg:reset DATABASE

 !    WARNING: Destructive Action
 !    This command will affect the app: pegjspl0
 !    To proceed, type "pegjspl0" or re-run this command with --confirm pegjspl0

&gt; pegjspl0
Resetting HEROKU_POSTGRESQL_BROWN_URL (DATABASE_URL)... done
</PRE>
Es necesario a continuación rearrancar el servidor:
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ heroku ps:restart
Restarting dynos... done
</PRE>

<P>

<H4><A NAME="SECTION07130070000000000000">
pg:pull</A>
</H4>
  

<code>pg:pull</code> can be used to pull remote data from a Heroku Postgres
database to a database on your local machine. The command looks like this:
<PRE>
[~/srcPLgrado/pegjscalc(master)]$ pg_ctl -D /usr/local/var/postgres -l /usr/local/var/postgres/server.log start
server starting
</PRE>

<P>
<PRE>
$ heroku pg:pull HEROKU_POSTGRESQL_MAGENTA mylocaldb --app sushi
</PRE>
This command will create a new local database named <code>mylocaldb</code> and
then pull data from database at <code>DATABASE_URL</code> from the app 
<code>sushi</code>. 

<P>
In
order to prevent accidental data overwrites and loss, the local database
must not exist. You will be prompted to drop an already existing local
database before proceeding.

<P>

<H4><A NAME="SECTION07130080000000000000">
pg:push</A>
</H4>
  

Like pull but in reverse, <code>pg:push</code> will push data from a local
database into a remote Heroku Postgres database. The command looks
like this:
<PRE>
$ heroku pg:push mylocaldb HEROKU_POSTGRESQL_MAGENTA --app sushi
</PRE>
This command will take the local database <code>mylocaldb</code> 
and push it
to the database at <code>DATABASE_URL</code> on the app <code>sushi</code>. 
In order to
prevent accidental data overwrites and loss, the remote database must
be empty. You will be prompted to <code>pg:reset</code> an already a remote database
that is not empty.

<P>

<DIV CLASS="navigation"><HR>
<A NAME="tex2html6137"
  HREF="node196.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html6131"
  HREF="node192.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html6125"
  HREF="node194.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html6133"
  HREF="node227.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html6135"
  HREF="node230.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~plgrado/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1213m2/course/view.php?id=271"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="http://crguezl.github.io/pl-html/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html7"
  HREF="https://developer.mozilla.org/es/docs/JavaScript"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html8"
  HREF="http://github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html9"
  HREF="https://plus.google.com/u/0/communities/107031495100582318205"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1314"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.ull.es/view/centros/etsii/Grado/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html6138"
  HREF="node196.html">Troubleshooting</A>
<B>Sup:</B> <A NAME="tex2html6132"
  HREF="node192.html">Heroku</A>
<B> Ant:</B> <A NAME="tex2html6126"
  HREF="node194.html">Logging</A>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2014-04-25</I>
</ADDRESS>
</BODY>
</HTML>
