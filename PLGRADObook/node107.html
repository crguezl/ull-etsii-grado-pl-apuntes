<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Ejemplo: Basic Authentication</TITLE>
<META NAME="description" CONTENT="Ejemplo: Basic Authentication">
<META NAME="keywords" CONTENT="javascriptexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node108.html">
<LINK REL="previous" HREF="node106.html">
<LINK REL="up" HREF="node95.html">
<LINK REL="next" HREF="node108.html">
</HEAD>

<BODY >

<DIV CLASS="navigation">
<A NAME="tex2html4464"
  HREF="node108.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html4458"
  HREF="node95.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html4452"
  HREF="node106.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html4460"
  HREF="node215.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html4462"
  HREF="node218.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~plgrado/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1213m2/course/view.php?id=271"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="http://crguezl.github.io/pl-html/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html7"
  HREF="https://developer.mozilla.org/es/docs/JavaScript"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html8"
  HREF="http://github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html9"
  HREF="https://plus.google.com/u/0/communities/107031495100582318205"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1314"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.ull.es/view/centros/etsii/Grado/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html4465"
  HREF="node108.html">Redirección</A>
<B>Sup:</B> <A NAME="tex2html4459"
  HREF="node95.html">Rack, un Webserver Ruby</A>
<B> Ant:</B> <A NAME="tex2html4453"
  HREF="node106.html">Práctica: Accediendo a Twitter</A>
<B> Con:</B> 
<A NAME="tex2html4460"
  HREF="node215.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>
<B> Ind:</B> 
<A NAME="tex2html4462"
  HREF="node218.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A>
<BR> <P>
</DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html4466"
  HREF="node107.html#SECTION061120010000000000000">Introducción</A>
<LI><A NAME="tex2html4467"
  HREF="node107.html#SECTION061120020000000000000">Protocolo</A>
<LI><A NAME="tex2html4468"
  HREF="node107.html#SECTION061120030000000000000">Ejemplo de BA en Rack</A>
<LI><A NAME="tex2html4469"
  HREF="node107.html#SECTION061120040000000000000">lobster.rb</A>
<LI><A NAME="tex2html4470"
  HREF="node107.html#SECTION061120050000000000000">etc/passwd.yml</A>
<LI><A NAME="tex2html4471"
  HREF="node107.html#SECTION061120060000000000000">Rakefile</A>
<LI><A NAME="tex2html4472"
  HREF="node107.html#SECTION061120070000000000000">Ejecución</A>
<LI><A NAME="tex2html4473"
  HREF="node107.html#SECTION061120080000000000000">Véase</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION061120000000000000000">
Ejemplo: Basic Authentication</A>
</H1>

<P>
<A NAME="tex2html528"
  HREF="http://rack.rubyforge.org/doc/Rack/Auth/Basic.html">Rack::Auth::Basic</A> implements 
<A NAME="tex2html529"
  HREF="http://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Authentication</A>, as per RFC 2617.

<P>

<H4><A NAME="SECTION061120010000000000000">
Introducción</A>
</H4>
  

<P>

<OL>
<LI>In the context of an HTTP transaction, basic access authentication
is a method for an HTTP user agent to provide a user name and
password when making a request.

<P>
</LI>
<LI><A NAME="17249"></A><SPAN  CLASS="textbf">HTTP Basic authentication</SPAN> (<A NAME="17251"></A><SPAN  CLASS="textbf">BA</SPAN>) implementation is the simplest
technique for enforcing access controls to web resources because
it doesn't require cookies, session identifier and login pages.
Rather, HTTP Basic authentication uses static, standard HTTP headers
which means that no handshakes have to be done in anticipation.

<P>
</LI>
<LI>The BA mechanism provides no confidentiality protection for the
transmitted credentials. They are merely encoded with <A NAME="tex2html530"
  HREF="http://en.wikipedia.org/wiki/BASE64">BASE64</A>
in
transit, but not encrypted or hashed in any way. Basic Authentication
is, therefore, typically used over HTTPS.

<P>
</LI>
<LI>Because BA header has to be sent with each HTTP request, the web
browser needs to cache the credentials for a reasonable period to
avoid constant prompting user for the username and password. Caching
policy differs between browsers. 

<P>
</LI>
<LI>While HTTP does not provide a method for web server to instruct the
browser to "log out" the user (forget cached credentials), there
are a number of workarounds using specific features in various
browsers. One of them is redirecting the user to an URL on the same
domain containing credentials that are intentionally incorrect
</LI>
</OL>

<P>

<H4><A NAME="SECTION061120020000000000000">
Protocolo</A>
</H4>
  

<P>

<OL>
<LI>When the server wants the user agent to authenticate itself towards
the server, it can send a request for authentication.
</LI>
<LI>This request should be sent using the HTTP 401 Not Authorized
response code containing a WWW-Authenticate HTTP header.
</LI>
<LI>The WWW-Authenticate header for basic authentication (used most
often) is constructed as following:
<PRE>
WWW-Authenticate: Basic realm="insert realm"
</PRE>
</LI>
<LI>When the user agent wants to send the server authentication credentials
it may use the Authorization header.
</LI>
<LI>The Authorization header is constructed as follows:
  
<OL>
<LI>Username and password are combined into a string <code>username:password</code>
</LI>
<LI>The resulting string literal is then encoded using Base64
</LI>
<LI>The authorization method and a space i.e. <code>Basic </code> is then put
  before the encoded string.
</LI>
<LI>For example, if the user agent uses 
  <code>Aladdin</code> as the username and
  <code>open sesame</code> as the password then the header is formed as
  follows:.
  <PRE>
  Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==
</PRE>
</LI>
</OL>
</LI>
</OL>

<P>

<H4><A NAME="SECTION061120030000000000000">
Ejemplo de BA en Rack</A>
</H4>
  

<P>
Initialize with the Rack application that you want protecting, and
a block that checks if a username and password pair are valid.

<P>
Puede encontrar el fuente en <A NAME="tex2html531"
  HREF="https://github.com/crguezl/rack-lobster/blob/master/protectedlobster.rb">GitHub</A>
<P>
<PRE>
[~/local/src/ruby/sinatra/rack/rack-lobster(master)]$ cat protectedlobster.rb
require 'rack'
require './lobster'
require 'yaml'

lobster = Rack::Lobster.new

passwd = YAML.load(File.open('etc/passwd.yml').read)

protected_lobster = Rack::Auth::Basic.new(lobster) do |username, password|
  passwd[username] == password
end

protected_lobster.realm = 'Lobster 2.0'
pretty_protected_lobster = Rack::ShowStatus.new(Rack::ShowExceptions.new(protected_lobster))

Rack::Server.start :app =&gt; pretty_protected_lobster, :Port =&gt; 9292
</PRE>

<P>

<H4><A NAME="SECTION061120040000000000000"></A>
<BR>
<A NAME="tex2html532"
  HREF="https://github.com/crguezl/rack-lobster/blob/master/lobster.rb">lobster.rb</A>
</H4>
  

<PRE>
[~/local/src/ruby/sinatra/rack/rack-lobster(master)]$ cat lobster.rb 
require 'rack/request'
require 'rack/response'

module Rack
  class Lobster
    LobsterString = "a lobster"

    def call(env)
      req = Request.new(env)

      req.env.keys.sort.each { |x| puts "#{x} =&gt; #{req.env[x]}" }

      if req.GET["flip"] == "left"
        lobster = LobsterString.reverse
        href = "?flip=right"
      elsif req.GET["flip"] == "crash"
        raise "Lobster crashed"
      else
        lobster = LobsterString
        href = "?flip=left"
      end

      res = Response.new
      res.write &lt;&lt;-"EOS"
      &lt;title&gt;Lobstericious!&lt;/title&gt;
      &lt;pre&gt;
      #{lobster}
      &lt;/pre&gt;
      &lt;p&gt;&lt;a href='#{href}'&gt;flip!&lt;/a&gt;&lt;/p&gt;
      &lt;p&gt;&lt;a href='?flip=crash'&gt;crash!&lt;/a&gt;&lt;/p&gt;
      EOS
      res.finish
    end
  end
end

if $0 == __FILE__
  require 'rack'
  require 'rack/showexceptions'
  Rack::Server.start(
    :app =&gt; Rack::ShowExceptions.new(
              Rack::Lint.new(
                Rack::Lobster.new)), 
    :Port =&gt; 9292,
    :server =&gt; 'thin'
  )
end
</PRE>

<P>

<H4><A NAME="SECTION061120050000000000000">
etc/passwd.yml</A>
</H4>
  

<P>
<PRE>
[~/local/src/ruby/sinatra/rack/rack-lobster(master)]$ cat etc/passwd.yml 
--- # Indented Block
   casiano: tutu
   ana: titi
</PRE>

<P>

<H4><A NAME="SECTION061120060000000000000">
Rakefile</A>
</H4>
  

<P>
<PRE>
[~/local/src/ruby/sinatra/rack/rack-lobster(master)]$ cat Rakefile
...

desc "run the server for protectedlobster"
task :protected do
  sh "ruby protectedlobster.rb"
end

desc "run the client with user and password flip left"
task :protectedleft do
  sh %q{curl -v --basic -u casiano:tutu 'http://localhost:9292?flip=left'}
end

...

task :crash do
  sh %q{curl -v 'http://localhost:9292/?flip=crash'}
end
</PRE>

<P>

<H4><A NAME="SECTION061120070000000000000">
Ejecución</A>
</H4>
  

<P>

<OL>
<LI>Servidor:
<PRE>
[~/local/src/ruby/sinatra/rack/rack-lobster(master)]$ rake protected
ruby protectedlobster.rb
&gt;&gt; Thin web server (v1.5.1 codename Straight Razor)
&gt;&gt; Maximum connections set to 1024
&gt;&gt; Listening on 0.0.0.0:9292, CTRL+C to stop
</PRE>
</LI>
<LI>Cliente:
<PRE>
[~/local/src/ruby/sinatra/rack/rack-lobster(master)]$ rake protectedleft
curl -v --basic -u casiano:tutu 'http://localhost:9292?flip=left'
* About to connect() to localhost port 9292 (#0)
*   Trying ::1... Connection refused
*   Trying 127.0.0.1... connected
* Connected to localhost (127.0.0.1) port 9292 (#0)
* Server auth using Basic with user 'casiano'
&gt; GET /?flip=left HTTP/1.1
&gt; Authorization: Basic Y2FzaWFubzpzZWNyZXRv
&gt; User-Agent: curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4 OpenSSL/0.9.8y zlib/1.2.5
&gt; Host: localhost:9292
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Content-Length: 168
&lt; Connection: keep-alive
&lt; Server: thin 1.5.1 codename Straight Razor
&lt; 
      &lt;title&gt;Lobstericious!&lt;/title&gt;
      &lt;pre&gt;
      retsbol a
      &lt;/pre&gt;
      &lt;p&gt;&lt;a href='?flip=right'&gt;flip!&lt;/a&gt;&lt;/p&gt;
      &lt;p&gt;&lt;a href='?flip=crash'&gt;crash!&lt;/a&gt;&lt;/p&gt;
* Connection #0 to host localhost left intact
* Closing connection #0
</PRE>
</LI>
<LI>Servidor después de la petición:
<PRE>
[~/local/src/ruby/sinatra/rack/rack-lobster(master)]$ rake protected
ruby protectedlobster.rb
&gt;&gt; Thin web server (v1.5.1 codename Straight Razor)
&gt;&gt; Maximum connections set to 1024
&gt;&gt; Listening on 0.0.0.0:9292, CTRL+C to stop
...
HTTP_AUTHORIZATION =&gt; Basic Y2FzaWFubzp0dXR1
REMOTE_USER =&gt; casiano
...
</PRE>
</LI>
</OL>

<P>

<img src="protectedlobster.png" />
<p>
Autentificación Básica: vista en el navegador

<P>

<p>
Si pulsamos "cancel" obtenemos:<p>
<p>
<img src="protectedlobstershowstatus.png" />

<P>

<H4><A NAME="SECTION061120080000000000000">
Véase</A>
</H4>
  

<P>

<OL>
<LI>Código de <A NAME="tex2html533"
  HREF="https://github.com/crguezl/rack-lobster">rack-lobster</A>
en GitHub
</LI>
<LI>Código fuente de <A NAME="tex2html534"
  HREF="https://github.com/rack/rack/blob/master/lib/rack/auth/basic.rb">Rack::Auth::Basic</A>
</LI>
<LI>Documentación en <A NAME="tex2html535"
  HREF="http://rack.rubyforge.org/doc/Rack/Auth/Basic.html">Rack::Auth::Basic</A>
</LI>
<LI>La Wikipedia <A NAME="tex2html536"
  HREF="http://en.wikipedia.org/wiki/Basic_access_authentication">Basic Access Authentication</A>
</LI>
</OL>

<P>

<DIV CLASS="navigation"><HR>
<A NAME="tex2html4464"
  HREF="node108.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html4458"
  HREF="node95.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html4452"
  HREF="node106.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html4460"
  HREF="node215.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html4462"
  HREF="node218.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html2"
  HREF="http://nereida.deioc.ull.es/~plgrado/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="PL"></A><A NAME="tex2html3"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1104"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html4"
  HREF="http://campusvirtual.ull.es/1213m2/course/view.php?id=271"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="PL moodle"></A><A NAME="tex2html5"
  HREF="javascriptexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="ps"></A><A NAME="tex2html6"
  HREF="http://crguezl.github.io/pl-html/"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html7"
  HREF="https://developer.mozilla.org/es/docs/JavaScript"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html8"
  HREF="http://github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html9"
  HREF="https://plus.google.com/u/0/communities/107031495100582318205"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="comunidad g+ PL1314"></A><A NAME="tex2html10"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html11"
  HREF="http://www.ull.es/view/centros/etsii/Grado/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html12"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html13"
  HREF="https://github.com/crguezl"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="crguezl at github"></A>
<BR>
<B> Sig:</B> <A NAME="tex2html4465"
  HREF="node108.html">Redirección</A>
<B>Sup:</B> <A NAME="tex2html4459"
  HREF="node95.html">Rack, un Webserver Ruby</A>
<B> Ant:</B> <A NAME="tex2html4453"
  HREF="node106.html">Práctica: Accediendo a Twitter</A>
</DIV>
<!--End of Navigation Panel-->
<ADDRESS>
<I>Casiano Rodríguez León <BR>
2014-03-29</I>
</ADDRESS>
</BODY>
</HTML>
